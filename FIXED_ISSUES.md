# 仪器管理系统 - 问题修复报告

## 修复的问题

### 1. 依赖问题修复 ✅
- **问题**: `requirements.txt` 中缺少 `Flask-WTF` 和 `WTForms` 依赖
- **修复**: 在 `requirements.txt` 中添加了缺失的依赖包
- **文件**: `requirements.txt`

### 2. 缺失路由实现 ✅
- **问题**: 模板文件中引用了不存在的路由 `find_student`, `find_record`, `search_student`
- **修复**: 在 `book_management_sys.py` 中实现了这些路由
- **新增路由**:
  - `/search_student` - 学生查询页面
  - `/find_student` - 查找学生信息API
  - `/find_record` - 查找借用记录API
  - `/user/student` - 用户端学生查询页面

### 3. 术语统一 ✅
- **问题**: 模板文件中仍使用图书相关术语，与后端仪器管理不一致
- **修复**: 将模板中的术语统一改为仪器相关
- **修改内容**:
  - "图书编号" → "仪器编号"
  - "书名" → "仪器名称"
  - "作者" → "制造商"
  - "还书日期" → "归还日期"

### 4. 数据库初始化 ✅
- **问题**: 缺少数据库初始化脚本和测试数据
- **修复**: 创建了完整的数据库初始化脚本
- **文件**: `init_db.py`
- **包含内容**:
  - 管理员账户 (201801/123456, 201802/123456)
  - 测试用户 (16000001, 16000002, 16000003)
  - 仪器信息 (数字万用表, 示波器, 信号发生器等)
  - 库存数据
  - 借用记录示例

### 5. 表单验证优化 ✅
- **问题**: 表单验证可能存在的问题
- **修复**: 检查并确认表单定义正确

## 系统功能

### 管理员功能
1. **登录系统** - 使用账号密码登录
2. **仪器查询** - 按名称、制造商、类别、编号查询
3. **仪器管理**:
   - 新仪器登记
   - 仪器入库
4. **借还管理**:
   - 学生借仪器
   - 学生还仪器
5. **用户查询** - 查询学生信息和借用记录
6. **个人设置** - 修改密码和个人信息

### 普通用户功能
1. **仪器查询** - 查看仪器信息
2. **学生查询** - 查看学生借用记录

## 安装和运行

### 1. 安装依赖
```bash
pip install -r requirements.txt
```

### 2. 初始化数据库
```bash
python init_db.py
```

### 3. 运行系统
```bash
python book_management_sys.py
# 或者使用简化脚本
python run.py
```

### 4. 访问系统
- 地址: http://127.0.0.1:5000
- 管理员账号: 201801
- 管理员密码: 123456

## 测试数据

### 管理员账户
- 201801 / 123456 (超级管理员)
- 201802 / 123456 (普通管理员)

### 测试用户
- 16000001 (张三) - 有借用记录
- 16000002 (李四) - 无借用记录
- 16000003 (王五) - 无借用记录

### 测试仪器
- 数字万用表 (福禄克 FLUKE-15B+)
- 示波器 (泰克 TBS1052B) - 其中一台已被借出
- 信号发生器 (安捷伦 33220A)
- 电源 (是德科技 E3631A)
- 频谱分析仪 (罗德与施瓦茨 FSW26)

## 技术栈
- **后端**: Flask + SQLAlchemy + Flask-Login + Flask-WTF
- **前端**: LayUI + jQuery
- **数据库**: SQLite
- **Python版本**: 3.6+

## 项目结构
```
├── book_management_sys.py  # 主应用文件
├── forms.py               # 表单定义
├── init_db.py            # 数据库初始化脚本
├── run.py                # 简化运行脚本
├── requirements.txt      # 依赖包列表
├── data.sqlite          # SQLite数据库文件
├── templates/           # HTML模板文件
├── static/             # 静态资源文件
└── venv/              # 虚拟环境(可选)
```

## 注意事项
1. 确保Python环境已正确安装所有依赖包
2. 首次运行前请执行数据库初始化脚本
3. 系统默认运行在5000端口
4. 建议在虚拟环境中运行项目
